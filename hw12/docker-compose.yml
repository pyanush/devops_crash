version: "2.3"
services:
   sftp:
     build: /home/hw12/ftp
     container_name: sftp
     ports:
         - "223:22"
     volumes: 
       - /home/hw12/ftp:/opt/data
       - /home/hw12/ftp:/opt/app
     networks:
       - devops_network     

   python:
     build: /home/hw12/python 
     container_name: python
     volumes: 
       - /home/hw12/ftp:/opt/data
       - /home/hw12/ftp:/opt/app
     healthcheck:
       test: ["CMD", "python", "sql_orm.py"]
       interval: 3s
       timeout: 5s
       retries: 5
       start_period: 1s

   nginx:
     build: /home/hw12/nginx
     ports:
       - "80:883"
     volumes:
       - /home/hw12/ftp:/opt/app
     depends_on:
       redis:
         condition: service_healthy
     environment:
       - ENV=development
   redis:
     image: redis
     volumes:
       - /home/hw12/nginx:/opt/data
     healthcheck:
       test: ["CMD", "redis-cli", "-v"]
       interval: 3s
       timeout: 5s
       retries: 5
       start_period: 1s

networks:
  devops_network:
    driver: bridge

# # #   nginx:
# # #     image: nginx:1.17.2-alpine
# # #     container_name: nginx
# # #     volumes: 
# # #       - ./dafault.conf:/etc/nginx/conf.d/default.conf
# # #     links:
# # #       - app
# # #     ports: 
# # #       - 8989:8989

